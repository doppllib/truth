//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel-doppl/core-doppl/androidbasetest/src/main/java/co/touchlab/doppel/testing/TestingContext.java
//

#include "AndroidAppSharedPreferencesImpl.h"
#include "AndroidContentContext.h"
#include "AndroidContentIOSContext.h"
#include "AndroidContentSharedPreferences.h"
#include "AndroidDatabaseDatabaseErrorHandler.h"
#include "AndroidDatabaseSqliteSQLiteDatabase.h"
#include "AndroidOsFileUtils.h"
#include "AndroidOsHandler.h"
#include "AndroidOsLooper.h"
#include "CoTouchlabDoppelTestingTestingContext.h"
#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "RenameComAndroidInternalUtilXmlUtils.h"
#include "android/util/Log.h"
#include "java/io/File.h"
#include "java/io/FileInputStream.h"
#include "java/io/FileNotFoundException.h"
#include "java/io/FileOutputStream.h"
#include "java/io/IOException.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"
#include "org/xmlpull/v1/XmlPullParserException.h"

@interface CoTouchlabDoppelTestingTestingContext () {
 @public
  id mSync_TestingContext_;
  JavaIoFile *rootDir_;
  JavaIoFile *mPreferencesDir_TestingContext_;
}

+ (JavaIoFile *)makeBackupFileWithJavaIoFile:(JavaIoFile *)prefsFile;

- (JavaIoFile *)makeFilenameWithJavaIoFile:(JavaIoFile *)base
                              withNSString:(NSString *)name;

- (JavaIoFile *)getPreferencesDir;

- (JavaIoFile *)findLocalFileWithNSString:(NSString *)name;

- (JavaIoFile *)getRootDir;

@end

J2OBJC_FIELD_SETTER(CoTouchlabDoppelTestingTestingContext, mSync_TestingContext_, id)
J2OBJC_FIELD_SETTER(CoTouchlabDoppelTestingTestingContext, rootDir_, JavaIoFile *)
J2OBJC_FIELD_SETTER(CoTouchlabDoppelTestingTestingContext, mPreferencesDir_TestingContext_, JavaIoFile *)

inline JavaUtilHashMap *CoTouchlabDoppelTestingTestingContext_get_sSharedPrefs();
static JavaUtilHashMap *CoTouchlabDoppelTestingTestingContext_sSharedPrefs;
J2OBJC_STATIC_FIELD_OBJ_FINAL(CoTouchlabDoppelTestingTestingContext, sSharedPrefs, JavaUtilHashMap *)

__attribute__((unused)) static JavaIoFile *CoTouchlabDoppelTestingTestingContext_makeBackupFileWithJavaIoFile_(JavaIoFile *prefsFile);

__attribute__((unused)) static JavaIoFile *CoTouchlabDoppelTestingTestingContext_makeFilenameWithJavaIoFile_withNSString_(CoTouchlabDoppelTestingTestingContext *self, JavaIoFile *base, NSString *name);

__attribute__((unused)) static JavaIoFile *CoTouchlabDoppelTestingTestingContext_getPreferencesDir(CoTouchlabDoppelTestingTestingContext *self);

__attribute__((unused)) static JavaIoFile *CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(CoTouchlabDoppelTestingTestingContext *self, NSString *name);

__attribute__((unused)) static JavaIoFile *CoTouchlabDoppelTestingTestingContext_getRootDir(CoTouchlabDoppelTestingTestingContext *self);

J2OBJC_INITIALIZED_DEFN(CoTouchlabDoppelTestingTestingContext)

NSString *CoTouchlabDoppelTestingTestingContext_DATABASES = @"databases";
NSString *CoTouchlabDoppelTestingTestingContext_TAG = @"IOSContext";

@implementation CoTouchlabDoppelTestingTestingContext

- (instancetype)initWithJavaIoFile:(JavaIoFile *)rootDir {
  CoTouchlabDoppelTestingTestingContext_initWithJavaIoFile_(self, rootDir);
  return self;
}

- (AndroidOsLooper *)getMainLooper {
  return AndroidOsLooper_getMainLooper();
}

+ (JavaIoFile *)makeBackupFileWithJavaIoFile:(JavaIoFile *)prefsFile {
  return CoTouchlabDoppelTestingTestingContext_makeBackupFileWithJavaIoFile_(prefsFile);
}

- (JavaIoFile *)getSharedPrefsFileWithNSString:(NSString *)name {
  return CoTouchlabDoppelTestingTestingContext_makeFilenameWithJavaIoFile_withNSString_(self, CoTouchlabDoppelTestingTestingContext_getPreferencesDir(self), JreStrcat("$$", name, @".xml"));
}

- (JavaIoFile *)makeFilenameWithJavaIoFile:(JavaIoFile *)base
                              withNSString:(NSString *)name {
  return CoTouchlabDoppelTestingTestingContext_makeFilenameWithJavaIoFile_withNSString_(self, base, name);
}

- (id<AndroidContentSharedPreferences>)getSharedPreferencesWithNSString:(NSString *)name
                                                                withInt:(jint)mode {
  AndroidAppSharedPreferencesImpl *sp;
  JavaIoFile *prefsFile;
  jboolean needInitialLoad = false;
  @synchronized(CoTouchlabDoppelTestingTestingContext_sSharedPrefs) {
    sp = [((JavaUtilHashMap *) nil_chk(CoTouchlabDoppelTestingTestingContext_sSharedPrefs)) getWithId:name];
    if (sp != nil && ![sp hasFileChangedUnexpectedly]) {
      return sp;
    }
    prefsFile = [self getSharedPrefsFileWithNSString:name];
    if (sp == nil) {
      sp = create_AndroidAppSharedPreferencesImpl_initWithJavaIoFile_withInt_withJavaUtilMap_withAndroidOsHandler_(prefsFile, mode, nil, create_AndroidOsHandler_initWithAndroidOsLooper_(AndroidOsLooper_getMainLooper()));
      [CoTouchlabDoppelTestingTestingContext_sSharedPrefs putWithId:name withId:sp];
      needInitialLoad = true;
    }
  }
  @synchronized(sp) {
    if (needInitialLoad && [sp isLoaded]) {
      return sp;
    }
    JavaIoFile *backup = CoTouchlabDoppelTestingTestingContext_makeBackupFileWithJavaIoFile_(prefsFile);
    if ([((JavaIoFile *) nil_chk(backup)) exists]) {
      [((JavaIoFile *) nil_chk(prefsFile)) delete__];
      [backup renameToWithJavaIoFile:prefsFile];
    }
    if ([((JavaIoFile *) nil_chk(prefsFile)) exists] && ![prefsFile canRead]) {
      AndroidUtilLog_wWithNSString_withNSString_(CoTouchlabDoppelTestingTestingContext_TAG, JreStrcat("$@$", @"Attempt to read preferences file ", prefsFile, @" without permission"));
    }
    id<JavaUtilMap> map = nil;
    AndroidOsFileUtils_FileStatus *stat = create_AndroidOsFileUtils_FileStatus_init();
    if (AndroidOsFileUtils_getFileStatusWithNSString_withAndroidOsFileUtils_FileStatus_([prefsFile getPath], stat) && [prefsFile canRead]) {
      @try {
        JavaIoFileInputStream *str = create_JavaIoFileInputStream_initWithJavaIoFile_(prefsFile);
        map = RenameComAndroidInternalUtilXmlUtils_readMapXmlWithJavaIoInputStream_(str);
        [str close];
      }
      @catch (OrgXmlpullV1XmlPullParserException *e) {
        AndroidUtilLog_wWithNSString_withNSString_withNSException_(CoTouchlabDoppelTestingTestingContext_TAG, @"getSharedPreferences", e);
      }
      @catch (JavaIoFileNotFoundException *e) {
        AndroidUtilLog_wWithNSString_withNSString_withNSException_(CoTouchlabDoppelTestingTestingContext_TAG, @"getSharedPreferences", e);
      }
      @catch (JavaIoIOException *e) {
        AndroidUtilLog_wWithNSString_withNSString_withNSException_(CoTouchlabDoppelTestingTestingContext_TAG, @"getSharedPreferences", e);
      }
    }
    [sp replaceWithJavaUtilMap:map withAndroidOsFileUtils_FileStatus:stat];
  }
  return sp;
}

- (JavaIoFile *)getPreferencesDir {
  return CoTouchlabDoppelTestingTestingContext_getPreferencesDir(self);
}

- (JavaIoFileInputStream *)openFileInputWithNSString:(NSString *)name {
  return create_JavaIoFileInputStream_initWithJavaIoFile_(CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(self, name));
}

- (JavaIoFileOutputStream *)openFileOutputWithNSString:(NSString *)name
                                               withInt:(jint)mode {
  return create_JavaIoFileOutputStream_initWithJavaIoFile_(CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(self, name));
}

- (JavaIoFile *)findLocalFileWithNSString:(NSString *)name {
  return CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(self, name);
}

- (jboolean)deleteFileWithNSString:(NSString *)name {
  JavaIoFile *localFile = CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(self, name);
  return [((JavaIoFile *) nil_chk(localFile)) delete__];
}

- (JavaIoFile *)getFileStreamPathWithNSString:(NSString *)name {
  return CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(self, name);
}

- (JavaIoFile *)getFilesDir {
  return [self getDirWithNSString:@"files" withInt:AndroidContentContext_MODE_PRIVATE];
}

- (JavaIoFile *)getRootDir {
  return CoTouchlabDoppelTestingTestingContext_getRootDir(self);
}

- (JavaIoFile *)getExternalFilesDirWithNSString:(NSString *)type {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (IOSObjectArray *)getExternalFilesDirsWithNSString:(NSString *)type {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (JavaIoFile *)getCacheDir {
  return [self getDirWithNSString:@"cache" withInt:AndroidContentContext_MODE_PRIVATE];
}

- (IOSObjectArray *)fileList {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (JavaIoFile *)getDirWithNSString:(NSString *)name
                           withInt:(jint)mode {
  JavaIoFile *rootDir = CoTouchlabDoppelTestingTestingContext_getRootDir(self);
  JavaIoFile *filesDir = create_JavaIoFile_initWithJavaIoFile_withNSString_(rootDir, name);
  [filesDir mkdirs];
  return filesDir;
}

- (AndroidDatabaseSqliteSQLiteDatabase *)openOrCreateDatabaseWithNSString:(NSString *)name
                                                                  withInt:(jint)mode
                    withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory:(id<AndroidDatabaseSqliteSQLiteDatabase_CursorFactory>)factory {
  return AndroidDatabaseSqliteSQLiteDatabase_openOrCreateDatabaseWithJavaIoFile_withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory_([self getDatabasePathWithNSString:name], factory);
}

- (AndroidDatabaseSqliteSQLiteDatabase *)openOrCreateDatabaseWithNSString:(NSString *)name
                                                                  withInt:(jint)mode
                    withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory:(id<AndroidDatabaseSqliteSQLiteDatabase_CursorFactory>)factory
                                  withAndroidDatabaseDatabaseErrorHandler:(id<AndroidDatabaseDatabaseErrorHandler>)errorHandler {
  return AndroidDatabaseSqliteSQLiteDatabase_openOrCreateDatabaseWithNSString_withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory_withAndroidDatabaseDatabaseErrorHandler_([((JavaIoFile *) nil_chk([self getDatabasePathWithNSString:name])) getPath], factory, errorHandler);
}

- (jboolean)deleteDatabaseWithNSString:(NSString *)name {
  return [((JavaIoFile *) nil_chk([self getDatabasePathWithNSString:name])) delete__];
}

- (JavaIoFile *)getDatabasePathWithNSString:(NSString *)name {
  JavaIoFile *dbDir = [self getDirWithNSString:CoTouchlabDoppelTestingTestingContext_DATABASES withInt:AndroidContentContext_MODE_PRIVATE];
  JavaIoFile *file = create_JavaIoFile_initWithJavaIoFile_withNSString_(dbDir, name);
  return file;
}

- (IOSObjectArray *)databaseList {
  return [((JavaIoFile *) nil_chk([self getDirWithNSString:CoTouchlabDoppelTestingTestingContext_DATABASES withInt:AndroidContentContext_MODE_PRIVATE])) list];
}

- (void)dealloc {
  RELEASE_(mSync_TestingContext_);
  RELEASE_(rootDir_);
  RELEASE_(mPreferencesDir_TestingContext_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LAndroidOsLooper;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0xa, 1, 0, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, 2, 3, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x2, 4, 5, -1, -1, -1, -1 },
    { NULL, "LAndroidContentSharedPreferences;", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoFileInputStream;", 0x1, 8, 3, 9, -1, -1, -1 },
    { NULL, "LJavaIoFileOutputStream;", 0x1, 10, 7, 9, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x2, 11, 3, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 12, 3, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, 13, 3, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, 14, 3, -1, -1, -1, -1 },
    { NULL, "[LJavaIoFile;", 0x1, 15, 3, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "[LNSString;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, 16, 7, -1, -1, -1, -1 },
    { NULL, "LAndroidDatabaseSqliteSQLiteDatabase;", 0x1, 17, 18, -1, -1, -1, -1 },
    { NULL, "LAndroidDatabaseSqliteSQLiteDatabase;", 0x1, 17, 19, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 20, 3, -1, -1, -1, -1 },
    { NULL, "LJavaIoFile;", 0x1, 21, 3, -1, -1, -1, -1 },
    { NULL, "[LNSString;", 0x1, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithJavaIoFile:);
  methods[1].selector = @selector(getMainLooper);
  methods[2].selector = @selector(makeBackupFileWithJavaIoFile:);
  methods[3].selector = @selector(getSharedPrefsFileWithNSString:);
  methods[4].selector = @selector(makeFilenameWithJavaIoFile:withNSString:);
  methods[5].selector = @selector(getSharedPreferencesWithNSString:withInt:);
  methods[6].selector = @selector(getPreferencesDir);
  methods[7].selector = @selector(openFileInputWithNSString:);
  methods[8].selector = @selector(openFileOutputWithNSString:withInt:);
  methods[9].selector = @selector(findLocalFileWithNSString:);
  methods[10].selector = @selector(deleteFileWithNSString:);
  methods[11].selector = @selector(getFileStreamPathWithNSString:);
  methods[12].selector = @selector(getFilesDir);
  methods[13].selector = @selector(getRootDir);
  methods[14].selector = @selector(getExternalFilesDirWithNSString:);
  methods[15].selector = @selector(getExternalFilesDirsWithNSString:);
  methods[16].selector = @selector(getCacheDir);
  methods[17].selector = @selector(fileList);
  methods[18].selector = @selector(getDirWithNSString:withInt:);
  methods[19].selector = @selector(openOrCreateDatabaseWithNSString:withInt:withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory:);
  methods[20].selector = @selector(openOrCreateDatabaseWithNSString:withInt:withAndroidDatabaseSqliteSQLiteDatabase_CursorFactory:withAndroidDatabaseDatabaseErrorHandler:);
  methods[21].selector = @selector(deleteDatabaseWithNSString:);
  methods[22].selector = @selector(getDatabasePathWithNSString:);
  methods[23].selector = @selector(databaseList);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "DATABASES", "LNSString;", .constantValue.asLong = 0, 0x19, -1, 22, -1, -1 },
    { "TAG", "LNSString;", .constantValue.asLong = 0, 0x19, -1, 23, -1, -1 },
    { "mSync_TestingContext_", "LNSObject;", .constantValue.asLong = 0, 0x12, 24, -1, -1, -1 },
    { "rootDir_", "LJavaIoFile;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "mPreferencesDir_TestingContext_", "LJavaIoFile;", .constantValue.asLong = 0, 0x2, 25, -1, -1, -1 },
    { "sSharedPrefs", "LJavaUtilHashMap;", .constantValue.asLong = 0, 0x1a, -1, 26, 27, -1 },
  };
  static const void *ptrTable[] = { "LJavaIoFile;", "makeBackupFile", "getSharedPrefsFile", "LNSString;", "makeFilename", "LJavaIoFile;LNSString;", "getSharedPreferences", "LNSString;I", "openFileInput", "LJavaIoFileNotFoundException;", "openFileOutput", "findLocalFile", "deleteFile", "getFileStreamPath", "getExternalFilesDir", "getExternalFilesDirs", "getDir", "openOrCreateDatabase", "LNSString;ILAndroidDatabaseSqliteSQLiteDatabase_CursorFactory;", "LNSString;ILAndroidDatabaseSqliteSQLiteDatabase_CursorFactory;LAndroidDatabaseDatabaseErrorHandler;", "deleteDatabase", "getDatabasePath", &CoTouchlabDoppelTestingTestingContext_DATABASES, &CoTouchlabDoppelTestingTestingContext_TAG, "mSync", "mPreferencesDir", &CoTouchlabDoppelTestingTestingContext_sSharedPrefs, "Ljava/util/HashMap<Ljava/lang/String;Landroid/app/SharedPreferencesImpl;>;" };
  static const J2ObjcClassInfo _CoTouchlabDoppelTestingTestingContext = { "TestingContext", "co.touchlab.doppel.testing", ptrTable, methods, fields, 7, 0x1, 24, 6, -1, -1, -1, -1, -1 };
  return &_CoTouchlabDoppelTestingTestingContext;
}

+ (void)initialize {
  if (self == [CoTouchlabDoppelTestingTestingContext class]) {
    JreStrongAssignAndConsume(&CoTouchlabDoppelTestingTestingContext_sSharedPrefs, new_JavaUtilHashMap_init());
    J2OBJC_SET_INITIALIZED(CoTouchlabDoppelTestingTestingContext)
  }
}

@end

void CoTouchlabDoppelTestingTestingContext_initWithJavaIoFile_(CoTouchlabDoppelTestingTestingContext *self, JavaIoFile *rootDir) {
  AndroidContentIOSContext_init(self);
  JreStrongAssignAndConsume(&self->mSync_TestingContext_, new_NSObject_init());
  JreStrongAssign(&self->rootDir_, rootDir);
  if (AndroidOsLooper_getMainLooper() == nil) AndroidOsLooper_prepareMainLooper();
}

CoTouchlabDoppelTestingTestingContext *new_CoTouchlabDoppelTestingTestingContext_initWithJavaIoFile_(JavaIoFile *rootDir) {
  J2OBJC_NEW_IMPL(CoTouchlabDoppelTestingTestingContext, initWithJavaIoFile_, rootDir)
}

CoTouchlabDoppelTestingTestingContext *create_CoTouchlabDoppelTestingTestingContext_initWithJavaIoFile_(JavaIoFile *rootDir) {
  J2OBJC_CREATE_IMPL(CoTouchlabDoppelTestingTestingContext, initWithJavaIoFile_, rootDir)
}

JavaIoFile *CoTouchlabDoppelTestingTestingContext_makeBackupFileWithJavaIoFile_(JavaIoFile *prefsFile) {
  CoTouchlabDoppelTestingTestingContext_initialize();
  return create_JavaIoFile_initWithNSString_(JreStrcat("$$", [((JavaIoFile *) nil_chk(prefsFile)) getPath], @".bak"));
}

JavaIoFile *CoTouchlabDoppelTestingTestingContext_makeFilenameWithJavaIoFile_withNSString_(CoTouchlabDoppelTestingTestingContext *self, JavaIoFile *base, NSString *name) {
  if ([((NSString *) nil_chk(name)) indexOf:JreLoadStatic(JavaIoFile, separatorChar)] < 0) {
    return create_JavaIoFile_initWithJavaIoFile_withNSString_(base, name);
  }
  @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$$", @"File ", name, @" contains a path separator"));
}

JavaIoFile *CoTouchlabDoppelTestingTestingContext_getPreferencesDir(CoTouchlabDoppelTestingTestingContext *self) {
  @synchronized(self->mSync_TestingContext_) {
    if (self->mPreferencesDir_TestingContext_ == nil) {
      JreStrongAssign(&self->mPreferencesDir_TestingContext_, [self getDirWithNSString:@"shared_prefs" withInt:AndroidContentContext_MODE_PRIVATE]);
    }
    return self->mPreferencesDir_TestingContext_;
  }
}

JavaIoFile *CoTouchlabDoppelTestingTestingContext_findLocalFileWithNSString_(CoTouchlabDoppelTestingTestingContext *self, NSString *name) {
  return create_JavaIoFile_initWithJavaIoFile_withNSString_([self getFilesDir], name);
}

JavaIoFile *CoTouchlabDoppelTestingTestingContext_getRootDir(CoTouchlabDoppelTestingTestingContext *self) {
  [((JavaIoFile *) nil_chk(self->rootDir_)) mkdirs];
  return self->rootDir_;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(CoTouchlabDoppelTestingTestingContext)
